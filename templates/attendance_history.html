{% extends 'base.html' %}
{% block content %}
<a href="{{ url_for('dashboard') }}" class="back-link">‚Üê Back to Dashboard</a>
<h1>Attendance History</h1>

{% set current_month = None %}
{% set current_week = None %}

{% for record in attendance_records|sort(attribute='date') %}
    {% set record_month = record.date.strftime('%B %Y') %}
    {% set record_week = record.date.isocalendar()[1] %} {# ISO week number #}

    {# New Month Header #}
    {% if record_month != current_month %}
        {% if not loop.first %}
            </tbody>
            </table>
        {% endif %}
        <h2 class="month-header">{{ record_month }}</h2>
        {% set current_month = record_month %}
        {% set current_week = None %}
    {% endif %}

    {# New Week Header & Table #}
    {% if record_week != current_week %}
        {% if current_week is not none %}
            </tbody>
            </table>
        {% endif %}
        <h3 class="week-header">Week {{ record_week }}</h3>
        <div class="attendance-table-container">
            <table class="attendance-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Worker Name</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
        {% set current_week = record_week %}
    {% endif %}

    <tr class="attendance-row">
        <td>{{ record.date.strftime('%d %b %Y') }}</td>
        <td>{{ record.worker.name }}</td>
        <td>{{ record.status }}</td>
    </tr>

    {% if loop.last %}
        </tbody>
        </table>
        </div>
    {% endif %}
{% endfor %}

{% endblock %}
