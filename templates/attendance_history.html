{% extends 'base.html' %}
{% block content %}
<a href="{{ url_for('dashboard') }}" class="back-link">‚Üê Back to Dashboard</a>
<h1>Attendance History</h1>

{% set current_week = None %}
{% set current_date = None %}

{% for record in attendance_records|sort(attribute='date') %}
    {% set record_week = record.date.strftime('Week %U, %Y') %}
    {% set record_date = record.date.strftime('%d %b %Y') %}

    {# New Week Header #}
    {% if record_week != current_week %}
        {% if not loop.first %}
            </ul>
        {% endif %}
        <h2 class="week-header">{{ record_week }}</h2>
        {% set current_week = record_week %}
        {% set current_date = None %}
    {% endif %}

    {# New Date Subheader #}
    {% if record_date != current_date %}
        {% if not loop.first and record_week == current_week %}
            </ul>
        {% endif %}
        <h3 class="date-header">{{ record_date }}</h3>
        <ul class="attendance-list">
        {% set current_date = record_date %}
    {% endif %}

    <li>{{ record.worker.name }} - {{ record.status }}</li>

    {# Close last list at the end #}
    {% if loop.last %}
        </ul>
    {% endif %}
{% endfor %}

{% endblock %}
