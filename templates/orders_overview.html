{% extends 'base.html' %}
{% block content %}
<div class="orders-overview-container">
    <div class="overview-header">
        <h1>üì¶ Orders Overview</h1>
        <p>All client orders categorized by product type.</p>

        <!-- ‚úÖ Smart Back to Dashboard Button -->
        {% if session['username'] == 'admin' %}
            <a href="{{ url_for('admin_dashboard') }}" 
               class="back-btn"
               style="display:inline-block; background:#03492c; color:#fff; padding:10px 18px; border-radius:6px; text-decoration:none; font-weight:500; transition:0.3s;">
               ‚Üê Back to Admin Dashboard
            </a>
        {% elif session['username'] == 'secretary' %}
            <a href="{{ url_for('secretary_dashboard') }}" 
               class="back-btn"
               style="display:inline-block; background:#03492c; color:#fff; padding:10px 18px; border-radius:6px; text-decoration:none; font-weight:500; transition:0.3s;">
               ‚Üê Back to Secretary Dashboard
            </a>
        {% else %}
            <a href="{{ url_for('dashboard') }}" 
               class="back-btn"
               style="display:inline-block; background:#03492c; color:#fff; padding:10px 18px; border-radius:6px; text-decoration:none; font-weight:500; transition:0.3s;">
               ‚Üê Back to Dashboard
            </a>
        {% endif %}
    </div>

    {% macro order_card(order) %}
    <div class="order-card">
        <div class="order-header">
            <h2>{{ order.items }}</h2>
            <span class="status {{ order.status|lower }}">{{ order.status }}</span>
        </div>

        <div class="order-info">
            <p><strong>Client:</strong> {{ order.name }}</p>
            <p><strong>Email:</strong> {{ order.email }}</p>
            <p><strong>Phone:</strong> {{ order.phone_number }}</p>
            <p><strong>Date Needed:</strong> {{ order.date_needed }}</p>
            <p><strong>Description:</strong> {{ order.description }}</p>
        </div>

        <div class="order-details">
            <p><strong>Quantity:</strong> {{ order.number_of_bags or 0 }} bags ({{ order.kilograms or 0 }} kg)</p>
            <p><strong>Unit Price:</strong> ‚Ç¶{{ "%.2f"|format(order.unit_price or 0) }}</p>
            <p><strong>Total:</strong> ‚Ç¶{{ "%.2f"|format(order.total_amount or 0) }}</p>
        </div>

        <div class="order-logistics">
            <p><strong>Driver:</strong> {{ order.driver_name or "‚Äî" }}</p>
            <p><strong>Vehicle Plate:</strong> {{ order.vehicle_plate_number or "‚Äî" }}</p>
        </div>

        <div class="order-bank">
            <p><strong>Bank Name:</strong> {{ order.bank_name or "‚Äî" }}</p>
            <p><strong>Account No:</strong> {{ order.account_number or "‚Äî" }}</p>
            <p><strong>Account Name:</strong> {{ order.account_bank_name or "‚Äî" }}</p>
        </div>

        {% if order.status != "Confirmed" %}
        <form method="POST" action="{{ url_for('confirm_order', order_id=order.id) }}" onsubmit="return confirm('Confirm this order?')">
            <button type="submit" class="confirm-btn">‚úÖ Confirm Order</button>
        </form>
        {% endif %}
    </div>
    {% endmacro %}

    {% set categories = {
        "Soya Beans Orders": soya_orders,
        "Cashew Nut Orders": cashew_orders,
        "Maize Orders": maize_orders,
        "Rice Orders": rice_orders
    } %}

    {% for category, orders in categories.items() %}
    <section class="order-category">
        <h2 class="category-title">{{ category }}</h2>
        {% if orders %}
            <div class="orders-grid">
                {% for order in orders %}
                    {{ order_card(order) }}
                {% endfor %}
            </div>
        {% else %}
            <p class="empty-msg">No orders available.</p>
        {% endif %}
    </section>
    {% endfor %}
</div>
{% endblock %}
